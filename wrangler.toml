name = "task-priority-app"
main = "src/server/index.ts"
compatibility_date = "2025-09-29"
compatibility_flags = ["nodejs_compat"]
account_id = "5cbaf7492795d0e9eafa26240b14389c"

# Assets (Frontend build output)
# SPA routing: not_found_handling serves index.html for non-matching routes
# This enables client-side routing (direct access to /reports, /focus, etc.)
[assets]
directory = "./dist"
not_found_handling = "single-page-application"

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "task-priority-db"
database_id = "7eafd761-97e9-4404-b70c-1dec57275214"
migrations_dir = "src/db/migrations"

# Rate Limiting
# Note: Create rate limiter with: wrangler rate-limit create api-rate-limit --limit 1000 --period 3600
# Temporarily disabled - uncomment after creating the rate limiter namespace
# [[unsafe.bindings]]
# name = "RATE_LIMITER"
# type = "ratelimit"
# namespace_id = "api-rate-limit"
# simple = { limit = 1000, period = 3600 }

# Variables (non-secret)
[vars]
ACCESS_AUD = "2aac6ffc5016ac95306ff002b39481010d0f279ad9ca6b8cc342c33853097162"

# Development environment
[env.development]
vars = { NODE_ENV = "development", ACCESS_AUD = "dev-environment" }

[[env.development.d1_databases]]
binding = "DB"
database_name = "task-priority-db-local"
database_id = "local"

# Development (local D1)
[dev]
port = 8787